<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shape Hunter</title>
<style>
body { margin:0; overflow:hidden; font-family:Arial, sans-serif; background:#e0f7fa; user-select:none; }
canvas { position:absolute; top:0; left:0; z-index:1; }
#levelSelect {
  position:absolute; top:50%; left:50%;
  transform:translate(-50%, -50%);
  font-size:24px;
  background:rgba(255,255,255,0.95);
  padding:20px; border-radius:15px; text-align:center;
  z-index:10;
}
button { font-size:20px; margin:10px; padding:10px 20px; cursor:pointer; }
</style>
</head>
<body>

<div id="levelSelect">
<h2>Select Level</h2>
<button onclick="startGame(1)">Level 1: Easy</button>
<button onclick="startGame(2)">Level 2: Medium</button>
<button onclick="startGame(3)">Level 3: 3D Shapes</button>
</div>

<audio id="ding" src="https://freesound.org/data/previews/522/522858_9454746-lq.mp3"></audio>
<audio id="chime" src="https://freesound.org/data/previews/348/348411_3248244-lq.mp3"></audio>
<audio id="finalMusic" src="SuperMario.mp3" preload="auto"></audio>

<canvas id="gameCanvas"></canvas>

<script>
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth; canvas.height=window.innerHeight;

const ding=document.getElementById('ding');
const chime=document.getElementById('chime');
const finalMusic=document.getElementById('finalMusic');
ding.volume=0.5; chime.volume=0.5;

let level=1, score=0, timeLeft=40;
let shapes=[], sparkles=[], wrongClicks=[];
let restartButton=null;
const numShapes=6, shapeSize=80;
let speed=1.125;
let timerInterval; let gameOver=false;
const boxWidth=canvas.width*0.9;
const boxHeight=canvas.height*0.9;
const boxX=(canvas.width-boxWidth)/2;
const boxY=(canvas.height-boxHeight)/2;
const infoBoxHeight=50;
let pulseTime=0;
let targetShape='';

let mouseX=0, mouseY=0;
canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  mouseX = e.clientX - rect.left;
  mouseY = e.clientY - rect.top;
});

const pastelColors=[
  'rgba(255,179,186,1)','rgba(255,223,186,1)','rgba(255,255,186,1)',
  'rgba(186,255,201,1)','rgba(186,225,255,1)'
];

const level3Shapes = ['cone','cube','sphere','rectangleprism','triangleprism','pyramid','torus','cylinder','hemisphere'];

const levelShapes = {
  1: ['triangle','circle','square','rectangle','rhombus','heart'],
  2: ['pentagon','hexagon','octagon','oval','trapezoid','star'],
  3: level3Shapes
};

// Preload level 3 images
const shapeImages = {};
let imagesLoaded = 0;
level3Shapes.forEach(name => {
  const img = new Image();
  img.src = name + '.png'; // PNG files must be in the same folder
  img.onload = () => {
    imagesLoaded++;
    if(imagesLoaded === level3Shapes.length){
      console.log("All level 3 images loaded");
    }
  }
  shapeImages[name] = img;
});

function randomInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

function createSparkles(x,y){
  for(let i=0;i<20;i++){
    let angle=Math.random()*2*Math.PI, spd=Math.random()*3+1;
    sparkles.push({x,y,vx:Math.cos(angle)*spd,vy:Math.sin(angle)*spd,life:30+randomInt(0,15),color:`hsl(${Math.random()*360},100%,70%)`});
  }
}

function generateShapes(){
  shapes=[]; wrongClicks=[];
  let positions=[];
  let currentShapes=levelShapes[level] || levelShapes[1];
  currentShapes=currentShapes.sort(()=>0.5-Math.random()).slice(0,numShapes);
  targetShape=currentShapes[randomInt(0,currentShapes.length-1)];

  for(let i=0;i<numShapes;i++){
    let shape=(currentShapes[i]===targetShape)?targetShape:currentShapes[i];
    let color=pastelColors[randomInt(0,pastelColors.length-1)];
    let x,y,tries=0;
    do{
      x=randomInt(boxX+shapeSize,boxX+boxWidth-shapeSize);
      y=randomInt(boxY+infoBoxHeight+shapeSize,boxY+boxHeight-shapeSize);
      tries++;
    } while(positions.some(p=>Math.hypot(p.x-x,p.y-y)<shapeSize*2)&&tries<100);
    positions.push({x,y});
    let angle=Math.random()*2*Math.PI;
    let vx=Math.cos(angle)*speed, vy=Math.sin(angle)*speed;
    shapes.push({x,y,vx,vy,shape,correct:shape===targetShape,color});
  }

  let utterance = new SpeechSynthesisUtterance(targetShape);
  speechSynthesis.speak(utterance);
}

function updateShapes(){
  if(gameOver) return;
  for(let i=0;i<shapes.length;i++){
    let s=shapes[i];
    s.vx+=(Math.random()-0.5)*0.05;
    s.vy+=(Math.random()-0.5)*0.05;
    let mag=Math.hypot(s.vx,s.vy);
    if(mag>speed){s.vx=(s.vx/mag)*speed;s.vy=(s.vy/mag)*speed;}
    s.x+=s.vx; s.y+=s.vy;

    if(s.x<boxX+shapeSize){s.x=boxX+shapeSize;s.vx*=-1;}
    if(s.x>boxX+boxWidth-shapeSize){s.x=boxX+boxWidth-shapeSize;s.vx*=-1;}
    if(s.y<boxY+infoBoxHeight+shapeSize){s.y=boxY+infoBoxHeight+shapeSize;s.vy*=-1;}
    if(s.y>boxY+boxHeight-shapeSize){s.y=boxY+boxHeight-shapeSize;s.vy*=-1;}

    for(let j=i+1;j<shapes.length;j++){
      let s2=shapes[j]; let dx=s2.x-s.x; let dy=s2.y-s.y;
      let dist=Math.hypot(dx,dy); let minDist=shapeSize*2;
      if(dist<minDist){
        let angle=Math.atan2(dy,dx); let overlap=minDist-dist;
        s.x-=Math.cos(angle)*overlap/2; s.y-=Math.sin(angle)*overlap/2;
        s2.x+=Math.cos(angle)*overlap/2; s2.y+=Math.sin(angle)*overlap/2;
        s.vx*=-0.8; s.vy*=-0.8; s2.vx*=-0.8; s2.vy*=-0.8;
      }
    }
  }
  for(let i=sparkles.length-1;i>=0;i--){
    let sp=sparkles[i]; sp.x+=sp.vx; sp.y+=sp.vy; sp.life--; if(sp.life<=0)sparkles.splice(i,1);
  }
}

function drawShape(s){
  ctx.save(); ctx.translate(s.x,s.y);
  if(level===3 && shapeImages[s.shape]){
    ctx.drawImage(shapeImages[s.shape], -shapeSize, -shapeSize, shapeSize*2, shapeSize*2);
  } else {
    ctx.fillStyle=s.color; ctx.strokeStyle='black'; ctx.lineWidth=3;
    switch(s.shape){
      case 'circle': ctx.beginPath(); ctx.arc(0,0,shapeSize,0,2*Math.PI); ctx.fill(); ctx.stroke(); break;
      case 'triangle': ctx.beginPath(); ctx.moveTo(0,-shapeSize); ctx.lineTo(shapeSize,shapeSize); ctx.lineTo(-shapeSize,shapeSize); ctx.closePath(); ctx.fill(); ctx.stroke(); break;
      case 'rectangle': ctx.fillRect(-shapeSize*1.5,-shapeSize,shapeSize*3,shapeSize*2); ctx.strokeRect(-shapeSize*1.5,-shapeSize,shapeSize*3,shapeSize*2); break;
      case 'square': ctx.fillRect(-shapeSize,-shapeSize,shapeSize*2,shapeSize*2); ctx.strokeRect(-shapeSize,-shapeSize,shapeSize*2,shapeSize*2); break;
    }
  }
  ctx.restore();
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle='rgba(255,255,255,0.8)';
  ctx.fillRect(boxX,boxY,boxWidth,boxHeight);
  ctx.strokeStyle='black'; ctx.lineWidth=4;
  ctx.strokeRect(boxX,boxY,boxWidth,boxHeight);

  ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.fillRect(boxX,boxY,boxWidth,infoBoxHeight);
  ctx.strokeRect(boxX,boxY,boxWidth,infoBoxHeight);

  ctx.fillStyle='red'; ctx.font='24px Arial'; ctx.textAlign='left';
  ctx.fillText(`Score: ${score}`, boxX+20, boxY+35);
  ctx.textAlign='right'; ctx.fillText(`Time: ${timeLeft}`, boxX+boxWidth-20, boxY+35);

  pulseTime+=0.05;
  let r=Math.floor(255*(0.5+0.5*Math.sin(pulseTime)));
  let b=Math.floor(255*(0.5+0.5*Math.cos(pulseTime)));
  ctx.fillStyle=`rgb(${r},0,${b})`;
  ctx.shadowColor='rgba(0,0,0,0.5)'; ctx.shadowBlur=10;
  ctx.font='36px Arial'; ctx.textAlign='center'; ctx.fillText('SHAPE HUNTER', boxX+boxWidth/2, boxY+35);

  shapes.forEach(s=>drawShape(s));

  wrongClicks.forEach(w=>{
    ctx.strokeStyle='red'; ctx.lineWidth=5;
    ctx.beginPath(); ctx.moveTo(w.shape.x-shapeSize,w.shape.y-shapeSize); ctx.lineTo(w.shape.x+shapeSize,w.shape.y+shapeSize);
    ctx.moveTo(w.shape.x+shapeSize,w.shape.y-shapeSize); ctx.lineTo(w.shape.x-shapeSize,w.shape.y+shapeSize);
    ctx.stroke();
  });

  sparkles.forEach(sp=>{
    ctx.beginPath(); ctx.arc(sp.x,sp.y,3,0,2*Math.PI); ctx.fillStyle=sp.color; ctx.fill();
  });

  const labelW=150,labelH=35;
  ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.strokeStyle='black'; ctx.lineWidth=2;
  ctx.fillRect(mouseX+15, mouseY+15, labelW, labelH); ctx.strokeRect(mouseX+15, mouseY+15, labelW, labelH);
  ctx.fillStyle='red'; ctx.font='20px Arial'; ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.fillText(targetShape.toUpperCase(), mouseX+15+labelW/2, mouseY+15+labelH/2);

  if(gameOver){
    const boxW=300, boxH=140; const boxXCenter=boxX+(boxWidth-boxW)/2; const boxYBottom=boxY+boxHeight-boxH-20;
    ctx.fillStyle='rgba(255,255,255,0.9)'; ctx.fillRect(boxXCenter,boxYBottom,boxW,boxH); ctx.strokeStyle='black'; ctx.lineWidth=3; ctx.strokeRect(boxXCenter,boxYBottom,boxW,boxH);
    ctx.fillStyle='red'; ctx.font='28px Arial'; ctx.textAlign='center';
    ctx.fillText(`Time's up!`, boxXCenter+boxW/2, boxYBottom+40); ctx.fillText(`Your score: ${score}`, boxXCenter+boxW/2, boxYBottom+75);
    const btnW=120, btnH=35; const btnX=boxXCenter+(boxW-btnW)/2; const btnY=boxYBottom+95;
    ctx.fillStyle='#4CAF50'; ctx.fillRect(btnX,btnY,btnW,btnH); ctx.strokeRect(btnX,btnY,btnW,btnH);
    ctx.fillStyle='white'; ctx.font='20px Arial'; ctx.fillText('Restart',btnX+btnW/2,btnY+btnH/2+7);
    restartButton={x:btnX,y:btnY,w:btnW,h:btnH};
  }
}

canvas.addEventListener('click',e=>{
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left, y=e.clientY-rect.top;
  if(gameOver && restartButton && x>=restartButton.x && x<=restartButton.x+restartButton.w && y>=restartButton.y && y<=restartButton.y+restartButton.h){ resetGame(); return; }
  shapes.forEach(s=>{
    let dx=x-s.x, dy=y-s.y;
    if(Math.hypot(dx,dy)<=shapeSize){
      if(s.correct && !gameOver){ score++; createSparkles(s.x,s.y); ding.play(); chime.play(); generateShapes(); wrongClicks=[]; }
      else{ wrongClicks.push({shape:s}); }
    }
  });
});

function resetGame(){ gameOver=false; shapes=[]; wrongClicks=[]; sparkles=[]; score=0; timeLeft=40; restartButton=null; document.getElementById('levelSelect').style.display='block'; }

function gameLoop(){ updateShapes(); draw(); requestAnimationFrame(gameLoop); }

function startGame(selectedLevel){
  level=selectedLevel; document.getElementById('levelSelect').style.display='none'; generateShapes(); gameLoop(); timeLeft=40;
  timerInterval=setInterval(()=>{
    timeLeft--;
    if(timeLeft<=0){
      clearInterval(timerInterval);
      gameOver=true;
      let utterance=new SpeechSynthesisUtterance(`Your final score is ${score}`);
      utterance.onend = () => { finalMusic.play(); };
      speechSynthesis.speak(utterance);
    }
  },1000);
}
</script>
</body>
</html>
